<!-- 支付密码-重置密码 -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" CONTENT="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="format-detection" content="telephone=no" />
    <title adct="首页">新疆化学品经营服务平台</title>
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <link rel="stylesheet" type="text/css" href="css/commin.css">
    <link rel="stylesheet" type="text/css" href="css/payPass.css">
    <link rel="stylesheet" type="text/css" href="css/jquery.step.css" />

    <style>
        .mianCont_box,.tabLinkMaxBox{display: none}
        .topTitle>.logo1{
            height: 100%;
        }
        .topTitle>.logo1>img{
            vertical-align: middle;
        }
        input{
            outline:none;
        }

        .topTitle {
            height: auto;
            line-height: 80px;
        }

        .topTitle>.phone {
            margin-top: 32px;
        }

        .step-bar {
            width: 68%;
            left: 145px;
        }

        .nextbtn {
            width: 160px;
            height: 34px;
            background-color: #6ba1ff;
            color: #fff;
            text-align: center;
            line-height: 36px;
            margin: 25px auto 0;
            border-radius: 2px;
            cursor: pointer;
            font-size: 14px;
        }

        .phone_input {
            width: 220px;
        }

        .code_input {
            width: 150px;
        }

        .phone1, .code.code0 {
            padding-right: 112px;
        }

        .second.phone1 {
            padding-right: 5px;
        }

        .submit {
            width: 160px;
            margin-left: 20px;
            height: 32px;
            border-radius: 2px;
            font-size: 14px;
            line-height: 32px;
            background-color: #6ba1ff;
            border: 1px solid #6ba1ff;
        }

        .code .send_code {
            font-size: 14px;
        }

        #sdphCode, #submitBtn {
            cursor: pointer;
        }
        .headerBot{display: none;}
    </style>
</head>
<body>
<script src="js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="js/header.js" type="text/javascript" charset="utf-8"></script>
<div class="topTitle mianCont">
    <div class="logo1 Lf"><a href="./index.html" style="float: left;height: 100%;"><img style="margin-top: 20px;padding-right: 20px;border-right: 1px solid #eeeeee;" src="./img/logo.png" alt=""></a><span style="margin-left: 20px;font-size: 30px;color: #666666; display: inline-block; margin-top: 28px;">找回密码</span></div>
    <div class="phone Rt">服务热线: <i style="color: #4E80F4;font-size: 22px;">4000-012-556</i> <i style="font-size: 10px;">（工作日9:00-18:00）</i></div>
</div>

<div class="mainCenter">
    <div class="mian_center">
        <div class="step-body" id="myStep">
            <div class="step-header" style="width:80%">
                <ul>
                    <li><p>进入账号</p></li>
                    <li><p>重置密码</p></li>
                    <li><p>修改成功</p></li>
                </ul>
            </div>
            <div class="step-content">
                <div class="step-list">
                    <div class="phone1">
                        <span class="required">*</span>
                        <span class="span">手机号：</span>
                        <input type="text" class="phone_input" id="oldPhone" placeholder="请输入正确的手机号" disabled="">
                    </div>
                    <div class="code code2">
                        <div class="clearfix inline-block">
                            <div class="fl">
                                <span class="required">*</span>
                                <span class="span" style="margin-right: 5px;">手机验证码：</span>
                            </div>
                            <div class="fl">
									<span class="clearfix inline-block">
										<input type="text" class="code_input fl" id="dxCode" placeholder="请输入短信验证码" onkeyup="this.value=chaneseCheck(this.value)">
										<span class="send_code fl" id="sdphCode">获取验证码</span>
									</span>
                            </div>
                        </div>
                    </div>
                    <div class="nextbtn" id="nextBtn">下一步</div>
                </div>
                <div class="step-list">
                    <div class="phone1 second">
                        <span class="required">*</span>
                        <span class="span">新密码：</span>
                        <input type="password" id="newPwd1" class="phone_input" maxlength="20" onkeyup="this.value=chaneseCheck(this.value)"  placeholder="6-20个字母、数字、特殊符号组成">
                    </div>
                    <div class="code code1">
                        <span class="required">*</span>
                        <span class="span">确认密码：</span>
                        <input type="password"  id="newPwd2" class="phone_input" maxlength="20" onkeyup="this.value=chaneseCheck(this.value)" placeholder="必须和设置的密码一致">
                    </div>
                    <div class="text-center mt">
                        <div class="clearfix inline-block">
                            <div class="nextbtn preBtn fl">取消</div>
                            <div class="submit fl" id="submitBtn">提交</div>
                        </div>
                    </div>
                </div>
                <div class="step-list">
                    <div class="update_pass_success">
                        <img src="./img/update_pass_success.png" alt="">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="mainFooter mianCont">
    <ul>
        <li><a href="##">首 页</a></li>
        <li class="line"></li>
        <li><a href="##">合作伙伴</a></li>
        <li class="line"></li>
        <li><a href="##">关于我们</a></li>
        <li class="line"></li>
        <li><a href="##">联系我们</a></li>
        <li class="line"></li>
        <li><a href="##">服务条款</a></li>
        <li class="line"></li>
        <li><a href="##">金融服务</a></li>
    </ul>
    <div class="mainFooterQuanxian">Copyright © 2016 www.xjv56.com All Rights Reserved 新疆化学品经营服务平台版权所有   新ICP备 16003842号-1</div>
</div>


<script src="./js/jquery-3.2.1.min.js"></script>
<script src="./js/jquery1.step.js"></script>
<script src="./js/common.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
    //禁止输入中文
    function chaneseCheck(str){
        var temp=""
        for(var i=0;i<str.length;i++)
            if(str.charCodeAt(i)>0&&str.charCodeAt(i)<255)
                temp+=str.charAt(i)
        return temp
    }
    var step= $("#myStep").step({
        animate:true,
        initStep:1,
        speed:1000
    });
    $(function() {
        getUserPhone();
        $("#dxCode").attr("disabled","disabled");


        $(".preBtn").click(function(event) {
            var yes=step.preStep();

        });

        $("#nextBtn").click(function(event) {
            // var yes=step.nextStep();
            smsCode(step);


        });


        $("#applyBtn").click(function(event) {
            var yes=step.nextStep();

        });
        $("#submitBtn").click(function(event) {

            sub(step);

        });
        $("#goBtn").click(function(event) {
            var yes=step.goStep(3);

        });



    });
    //获取手机号
    function getUserPhone(step) {
        $.ajax({
            type:"post",
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            url: pubIP+"finance/getFinancePhone",//v1.0
            cache:false,
            data:{
            },
            dataType: "json",
            success: function(json){
                console.log(json);
                if(json.code == '0'){
                    $("#oldPhone").val(json.data);
                }else{

                }
            }
        });
    }
    //第一步
    //获取短信验证码
    var canSend = true;
    $('#sdphCode').click(function(){
        if(canSend){
            $.ajax({
                type:"post",
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                url: pubIP+"userCarriers/getMessageCode",//v1.0
                cache:false,
                data:{
                    'mobile':$('#oldPhone').val(),
                    type: 1 //找回支付密码验证码
                },
                dataType: "json",
                success: function(json){
                    console.log(json);
                    if(json.code==1){
                        $('#dxCode').removeAttr("disabled");
                    }
                }
            });
            canSend = false;
            var isi = 0;
            var times = setInterval(function(){
                isi++;
                $('#sdphCode').text(60-isi+'秒后获取');
                $('#sdphCode').css('background', '#ccc');
                if(isi == 60){
                    console.log(isi);
                    clearInterval(times);
                    $('#sdphCode').text('获取验证码');
                    $('#sdphCode').css('background', 'rgba(53,130,248,1)');
                    canSend = true;
                }
            },1000);
        }

    })
    //校验短信验证码
    function smsCode() {
        $.ajax({
            type:"post",
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            url: pubIP+"userCarriers/validSmsCode",//v1.0
            cache:false,
            data:{
                mobile:$("#oldPhone").val(),
                smsRandomCode:$("#dxCode").val()
            },
            dataType: "json",
            success: function(json){
                console.log(json);
                debugger
                if(json.code == '1'){
                    var yes=step.nextStep();
                }else{
                    alert(json.msg);
                }
            }
        });
    }
    //第二步
    //校验密码
    $('#newPwd1').bind('input propertychange',function () {

        if($("#newPwd1").val()=="" || $("#newPwd1").val().length<6){
            $("#newPwd1").css('border-color','red');
        }else{
            $("#newPwd1").css('border-color','#D3D3D3');
        }
    });
    //二次校验密码
    $('#newPwd2').bind('input propertychange',function () {
        if($("#newPwd2").val()=="" || $("#newPwd2").val().length<6 || $("#newPwd2").val()!=$("#newPwd1").val()){
            $("#newPwd2").css('border-color','red');
            return;
        }else{
            $("#newPwd2").css('border-color','#D3D3D3');
        }
    });
    //提交
    function sub(step) {

        if($("#newPwd1").val()=="" || $("#newPwd1").val().length<6){
            $("#newPwd1").css('border-color','red');
            return;
        }else{
            $("#newPwd1").css('border-color','#D3D3D3');
        }
        if($("#newPwd2").val()=="" || $("#newPwd2").val().length<6 || $("#newPwd2").val()!=$("#newPwd1").val()){
            $("#newPwd2").css('border-color','red');
            return;
        }else{
            $("#newPwd2").css('border-color','#D3D3D3');
        }

        var pw=$("#newPwd2").val();
        var leav=-1;
        var numC=0;
        var strC=0;
        var str_C=0;
        for(var i=0;i<pw.length;i++){
            if(pw[i]<=9 && pw[i]>=0){
                numC=1;
            }else if(pw[i]>='A'&&pw[i]<='Z' || pw[i]>='a'&& pw[i]>='z'){
                strC=1;
            }else{
                str_C=1;
            }
        }
        leav=leav+parseInt(numC)+parseInt(strC)+parseInt(str_C);//安全等级
        console.log(token)
        $.ajax({
            url: pubIP + 'carrierUser/losePayPassword', /*v1.0*/
            type: 'post',
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            cache: false,
            ansyc: true,
            dataType: 'json',
            data:{
                newPayPassword:$("#newPwd1").val(),
                securityGrade:leav
            },
            success: function (data) {
                console.log(data)
                if(data.code==1){
                    var yes=step.nextStep();
                }else{
                    alert(data.msg)
                }
            },
            error: function(err){
                console.log(err);
            }
        })
    }

</script>
</body>
</html>