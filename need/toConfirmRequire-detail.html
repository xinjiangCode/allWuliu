<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" CONTENT="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="format-detection" content="telephone=no" />
    <title>新疆物流服务平台</title>
    <link rel="stylesheet" type="text/css" href="../css/commin.css"/>
    <link rel="stylesheet" href="../css/require_style/publishRequireList-detail.css">
    <style>
        /* baojiaCompany */
        .baojiaCompany>.contBox{
            overflow: hidden;
        }
        .baojiaCompany .ll{
            width: 327px;
        }
        .baojiaCompany .mm{
            width: 320px;
        }
        .baojiaCompany .rr{
            width: 285px;
        }
        .baojiaCompany .rr .select{
            margin-right: 15px;
        }
        /* operator */
        .contBox{
            overflow: hidden;
        }
        .operator .ll,.myOffer .ll{
            width: 327px;
        }
        .operator .mm,.myOffer .mm{
            width: 320px;
        }
        .operator .rr,.myOffer .rr{
            width: 285px;
        }

    </style>
</head>
<body>
    <div class="contbox-prld">
        <div class="toptitle title">
            <span>待确认详情</span>
            <div class="fr baojiaBtn">报价</div>
            <div class="fr closeBtn" onclick="javascript:history.back(-1);"><img src="../img/prl-close.png" alt="" width="11" height="11">关&nbsp;&nbsp;闭</div>
            <div class="fr freshBtn cfRefresh"><img src="../img/prl-refresh.png" alt="" width="27" height="34">刷&nbsp;&nbsp;新</div>
        </div>

        <div class="requireInfo infoBox">
            <div class="title"><img src="../img/prl-titlelogo.png" width="29" height="28" alt="">需求信息</div>
            <div class="contBox">
                <div class="contlist contlistone">
                    <div class="left ll">
                        <div>需求编号：<span id="demandNo">201707196369321</span></div>
                        <div>发布时间：<span id="createTime">2015-09-08 23:00</span></div>
                        <!--<div>装车时间：<span>2015-09-08 23:00</span></div>-->
                    </div>
                    <div class="left rr">
                        <div>始&nbsp;&nbsp;发&nbsp;&nbsp;地：<span class="sendAddress">新疆-乌鲁木齐-xxxx区-xxxx路-xxxx号xxx详情</span></div>
                        <div class="desti">目&nbsp;&nbsp;的&nbsp;&nbsp;地：<span  class="destination receiveAddresss">新疆-乌鲁木齐-xxxx区-xxxx路-xxxx号xxx详情中华人民共和国北京市东城区朝阳花园</span></div>
                    </div>
                </div>
                <div class="contlist contlisttwo">
                    <div class="left ll">
                        <div>化学品名：<span id="chemicalName">危化</span></div>
                        <div>重&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;量：<span id="goodsWeight">150吨</span></div>
                        <!--<div>支付方式：<span>预付</span></div>-->
                        <!--<div>保&nbsp;&nbsp;证&nbsp;&nbsp;金：<span>¥1000.00</span></div>-->
                        <div>支付方式：<span id="paymentType">现汇</span></div>
                    </div>
                    <div class="left mm">
                        <div>包装类型：<span id="packageType">罐装</span></div>
                        <div>开&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;票：<span id="invoiceType">普票</span></div>
                        <div>备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注：<span id="goodsRemark" style="text-overflow: ellipsis;overflow: hidden;white-space: nowrap;width: 231px;display: inline-block;    height: 21px;">备注信息</span></div>
                        <!--<div>缴纳方式：<span>抵扣</span></div>-->
                    </div>
                    <div class="left rr">
                        <div>货物名称：<span class="goodsName">片碱</span></div>
                        <div>车辆类型：<span id="carType">罐装车</span></div>
                        <!--<div>回&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;单：<span>需要</span></span></div>-->

                    </div>
                </div>
            </div>
        </div>
        <div class="dangerIntroduce infoBox">
            <div class="title"><img src="../img/prl-titlelogo.png" width="29" height="28" alt="">危险品介绍<div>查看更多信息</div></div>
            <div class="contBox">
                <div class="left ll">名&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;称：<span class="goodsName">片碱</span></div>
                <div class="left mm">学&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名：<span>氢氧化钠</span></div>
                <div class="left rr">危险等级：<span>重度危险</span></div>
            </div>
        </div>
        <div class="myOffer infoBox">
            <div class="title"><img src="../img/prl-titlelogo.png" width="29" height="28" alt="">我的报价</div>
            <!--<div class="contBox">-->
                <!--<div class="left ll">报价时间：<span>2017-07-19 23:00</span></div>-->
                <!--<div class="left mm">报&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;价：<span>120元/吨</span></div>-->
                <!--<div class="left rr">结&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;果：<span>推送中</span></div>-->
            <!--</div>-->
            <!--<div class="contBox">-->
                <!--<div class="left ll">报价时间：<span>2017-07-19 23:00</span></div>-->
                <!--<div class="left mm">报&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;价：<span>120元/吨</span></div>-->
                <!--<div class="left rr">结&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;果：<span>推送中</span></div>-->
            <!--</div>-->
        </div>
    </div>
    <script src="../js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/common.js" type="text/javascript" charset="utf-8"></script>
    <script>
        $(function () {
            window.parent.$("#Iframe").css("height","654");
        })
        getData();
        //获取数据
        function getData() {
            $.ajax({
                url: pubIP + 'wlLogisticsDemand/query', /*v1.0*/
                type: 'get',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                cache: false,
                ansyc: true,
                dataType: 'json',
                data:{
                    id:sessionStorage.getItem("detailId")
                },
                success: function (res) {
                    if(res.code===1){
                        cf_dataRender(res.data)
                    }else{
                        alert(res.msg);
                    }
                },
                error: function(err){
                    console.log(err);
                }
            });
        }

        //渲染数据
        function cf_dataRender(data) {
            $("#demandNo").text(data.demandNo);
            $("#createTime").text(timestampToTime1(data.createTime));
            $(".sendAddress").eq(0).text(data.sendProvince+"-"+data.sendCity+"-"+data.sendArea+"-"+data.sendAddress);
            $(".sendAddress").eq(1).text(data.sendProvince+"-"+data.sendCity+"-"+data.sendArea+"-"+data.sendAddress);
            $(".receiveAddresss").eq(0).text(data.receiveProvince+"-"+data.receiveCity+"-"+data.receiveArea+"-"+data.receiveAddress);
            $(".receiveAddresss").eq(1).text(data.receiveProvince+"-"+data.receiveCity+"-"+data.receiveArea+"-"+data.receiveAddress);
            $("#chemicalName").text(data.chemicalName);
                $("#goodsWeight").text(data.goodsNum+data.goodsUnit);
            $("#packageType").text(data.packageType);
            $("#invoiceType").text(data.invoiceType);
            $("#paymentType").text(data.paymentType);
            $(".goodsName").eq(0).text(data.goodsName);
            $(".goodsName").eq(1).text(data.goodsName);
            $("#carType").text(data.carType);

            $("#goodsRemark").text(data.goodsRemark);
            $("#sendUser").text(data.sendUser);
            $("#sendPhone").text(data.sendPhone );
            $("#sendCompanyname").text(data.sendCompanyname);
            $("#receiveUser").text(data.receiveUser);
            $("#receivePhone").text(data.receivePhone);
            $("#receiveCompanyname").text(data.receiveCompanyname);
        }






        $(".baojiaBtn").click(function () {
            window.parent.$(".modelBox0").show();
            getDataCompanyList()
            getDataSelect()
        })
        ////////////////////////////////选择公司弹框
        window.parent.$(".modelBox0 .sure1").unbind();
        window.parent.$(".modelBox0 .sure1").click(function () {
            $.ajax({
                url: pubIP + 'wlDemandQuoted/demandQuoted', /*v1.0*/
                type: 'post',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                cache: false,
                ansyc: true,
                dataType: 'json',
                data:{
                    demandid:sessionStorage.getItem("detailId") ,
                    quotedPrice:window.parent.$(".modelBox0 .quotedPrice").val()
                },
                success: function (res) {
                    if(res.code===1){
                        alert("报价成功")
                        location.reload();
                    }else{
                        alert(res.msg);
                    }
                },
                error: function(err){
                    console.log(err);
                }
            });
        })

        //获取更改报价弹框数据
        function getDataSelect() {
            $.ajax({
                url: pubIP + 'wlLogisticsDemand/query', /*v1.0*/
                type: 'get',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                cache: false,
                ansyc: true,
                dataType: 'json',
                data:{
                    id:sessionStorage.getItem("detailId")
                },
                success: function (res) {
                    if(res.code===1){
                        cf_dataRenderSelect(res.data)
                    }else{
                        alert(res.msg);
                    }
                },
                error: function(err){
                    console.log(err);
                }
            });
        }
        //选择公司  弹框 关闭
        window.parent.$(".modelBox0 img.close").click(function () {
            $(this).parents(".modelCont").parent().hide();
        })
        //渲染更改报价弹框数据
        function cf_dataRenderSelect(data) {
            window.parent.$(".modelBox0 .demandNo").text(data.demandNo);
            window.parent.$(".modelBox0 .createTime").text(timestampToTime1(data.createTime));
            window.parent.$(".modelBox0 .sendAddress").eq(0).text(data.sendProvince+"-"+data.sendCity+"-"+data.sendArea+"-"+data.sendAddress);
            window.parent.$(".modelBox0 .sendAddress").eq(1).text(data.sendProvince+"-"+data.sendCity+"-"+data.sendArea+"-"+data.sendAddress);
            window.parent.$(".modelBox0 .receiveAddresss").eq(0).text(data.receiveProvince+"-"+data.receiveCity+"-"+data.receiveArea+"-"+data.receiveAddress);
            window.parent.$(".modelBox0 .receiveAddresss").eq(1).text(data.receiveProvince+"-"+data.receiveCity+"-"+data.receiveArea+"-"+data.receiveAddress);
            window.parent.$(".modelBox0 .goodsType").text(data.goodsType);
            if(data.goodsUnit=="重量/吨"){
                window.parent.$(".modelBox0 .goodsWeight").text(data.goodsNum+'吨');
            }else{
                window.parent.$(".modelBox0 .goodsWeight").text(data.goodsNum+'m³');
            }
            window.parent.$(".modelBox0 .packageType").text(data.packageType);
            window.parent.$(".modelBox0 .invoiceType").text(data.invoiceType);
            window.parent.$(".modelBox0 .paymentType").text(data.paymentType);
            window.parent.$(".modelBox0 .goodsName").eq(0).text(data.goodsName);
            window.parent.$(".modelBox0 .goodsName").eq(1).text(data.goodsName);
            window.parent.$(".modelBox0 .carType").text(data.carType);
            window.parent.$(".modelBox0 .goodsRemark").text(data.goodsRemark);
            window.parent.$(".modelBox0 .sendUser").text(data.sendUser);
            window.parent.$(".modelBox0 .sendPhone").text(data.sendPhone );
            window.parent.$(".modelBox0 .sendCompanyname").text(data.sendCompanyname);
            window.parent.$(".modelBox0 .receiveUser").text(data.receiveUser);
            window.parent.$(".modelBox0 .receivePhone").text(data.receivePhone);
            window.parent.$(".modelBox0 .receiveCompanyname").text(data.receiveCompanyname);

            if(data.goodsUnit=="重量/吨"){
                window.parent.$(".modelBox0 .danjiadanwei").text('元/吨');
            }else{
                window.parent.$(".modelBox0 .danjiadanwei").text('元/m³');
            }
        }

        //获取报价公司列表  暂时不用
        function getDataCompanyList() {
            $("#baoJiaompany").html("");
            $.ajax({
                url: pubIP + 'wlDemandQuoted/queryList', /*v1.0*/
                type: 'get',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                cache: false,
                ansyc: true,
                dataType: 'json',
                data:{
                    demandid:sessionStorage.getItem("detailId")
                },
                success: function (res) {
                    if(res.code===1){
                        var  str="";
                        $.each(res.data.data,function (idx,item) {
                            str+='<ul class="clearFloat" style="padding: 5px 0;"  data-id='+item.id+'>';
                            str+='<li class="Lf" style="width: 292px;">公司名称：<span >'+item.companyname+'</span></li>';
                            str+='<li class="Lf" style="width: 292px;">报&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;价：<span id="unitPrice">'+item.quotedPrice+'元/吨</span></li>'
                            str+='<li class="Lf" data-id="'+item.demandid+'" data-demandid="'+item.demandid+'" data-companyid="'+item.companyid+'"><span class=" btn blue sel" style="color: #6ea3f4;">选&nbsp;&nbsp;择</span><span class="del btn" style="margin-left: 20px;">删&nbsp;&nbsp;除</span></li>'
                            str+="</ul>"
                        })
                        window.parent.$(".modelBox0 .baoJiaompany").html(str);
                        //选择公司
                        window.parent.$(".modelBox0 .sel").click(function () {
                            var demandid= $(this).parent().attr("data-demandid")
                            var companyid=$(this).parent().attr("data-companyid")
                            $.ajax({
                                url: pubIP + 'wlDemandQuoted/queryList', /*v1.0*/
                                type: 'get',
                                headers: {
                                    Accept: "application/json; charset=utf-8",
                                    token: token
                                },
                                cache: false,
                                ansyc: true,
                                dataType: 'json',
                                data:{
                                    demandid:demandid,
                                    companyid:companyid,
                                },
                                success: function (res) {
                                    if(res.code==1){
                                        alert("选择公司成功");
                                    }else{
                                        alert(res.msg);
                                    }

                                },
                                error: function(err){
                                    console.log(err);
                                }
                            });
                        })
                        //删除公司
                        window.parent.$(".del").click(function () {
                            var id= $(this).parent().attr("data-id")
                            $.ajax({
                                url: pubIP + 'wlDemandQuoted/updateForRejectCompany', /*v1.0*/
                                type: 'post',
                                headers: {
                                    Accept: "application/json; charset=utf-8",
                                    token: token
                                },
                                cache: false,
                                ansyc: true,
                                dataType: 'json',
                                data:{
                                    id:id,
                                },
                                success: function (res) {
                                    if(res.code==1){
                                        alert("删除公司成功");
                                        location.reload();
                                    }else{
                                        alert(res.msg);
                                    }

                                },
                                error: function(err){
                                    console.log(err);
                                }
                            });
                        })
                    }else{
                        alert(res.msg);
                    }
                },
                error: function(err){
                    console.log(err);
                }
            });
        }
    </script>
</body>
</html>