<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="Cache-Control" CONTENT="no-cache">
	<meta http-equiv="Pragma" content="no-cache">
	<meta name="format-detection" content="telephone=no" />
	<title>新疆物流服务平台</title>
	<link rel="stylesheet" type="text/css" href="../css/swiper.min.css"/>
	<link rel="stylesheet" type="text/css" href="../css/commin.css"/>
	<link rel="stylesheet" href="../css/setUp_messageManage.css">
	<style>
		.searchResultBtn{
			outline: none;
			border: none;
			padding: 0;
			text-align: center;
			width: 94px;
			color: #fff;
			background: #6ba1ff;
			cursor: pointer;
			border-radius: 3px;
			height: 38px;
			box-sizing: border-box;
			margin-left: 0px;
			float: right;
			margin-top: 20px;
			margin-right: 11px;
		}
	</style>
</head>
<body>
<!--消息管理-->
<div class="rightContBox" style="float: none;">
	<!--头部-->
	<div class="boxHead">
		<div class="headLeft">消息管理</div>
		<!--<div class="headRight cfRefresh">-->
		<!--<img src="../img/yh_refresh2.png"/>-->
		<!--<span>刷新</span>-->
		<!--</div>-->
	</div>
	<!--<div class="filtersech">-->
	<!--<div class="filter1">筛选查询</div>-->
	<!---->
	<!--<div class="filter3">查询结果</div>-->
	<!--<div class="filter2"><input type="checkbox" name="" id="" value="" />收起筛选</div>-->
	<!--</div>-->
	<div class="messages">
		<div class="mesgfirst" style="width: 260px;"><span>消息标题</span><input placeholder="消息标题" type="text" name="" id="msgTitle"  style="width: 160px"></div>
		<!--<div><span>消息类型</span>-->
		<!--<div class="select" data-selectedindex="0"><span style="margin-left: 0;"></span><img src="../img/prl-select.jpg" alt="">-->
		<!--<ul>-->
		<!--<li data-index="1">10</li>-->
		<!--<li data-index="2">20</li>-->
		<!--<li data-index="3">30</li>-->
		<!--</ul>-->
		<!--</div>-->
		<!--</div>-->
		<div class="mesglast" style="width: 550px;">
			<span>发布时间</span>
			<div style="width: 182px;">
				<input style="width: 89%;" type="text" class="date-input laydate-icon publishTime input" placeholder="请选择日期" id="test1">
			</div>
			<span style="margin: 0 5px;">-</span>
			<div style="width: 182px;">
				<input style="width: 89%;" type="text" class="date-input laydate-icon publishTime input" placeholder="请选择日期" id="test2">
			</div>
		</div>
		<input class="searchResultBtn btn input" type="button" value="查询结果" style="margin-left: 0px; float: right; margin-top: 20px; margin-right: 11px;">
	</div>
	<!--<div class="record">-->
	<!--<div></div>-->
	<!--<div class="goodsType input select" data-selectedindex="0"><span>排序方式</span><img src="../img/prl-select.jpg" >-->
	<!--<ul>-->
	<!--<li data-index="1">待分配订单</li>-->
	<!--<li data-index="2">进行中订单</li>-->
	<!--<li data-index="3">完成待审核订单</li>-->
	<!--<li data-index="3">已完成订单</li>-->
	<!--</ul>-->
	<!--</div>-->
	<!--<div class="goodsType input select" data-selectedindex="0"><span>显示条数</span><img src="../img/prl-select.jpg" >-->
	<!--<ul>-->
	<!--<li data-index="1">待分配订单</li>-->
	<!--<li data-index="2">进行中订单</li>-->
	<!--<li data-index="3">完成待审核订单</li>-->
	<!--<li data-index="3">已完成订单</li>-->
	<!--</ul>-->
	<!--</div>-->
	<!--&lt;!&ndash;<div>排序方式<img src="../img/cf_open.png"/></div>&ndash;&gt;-->
	<!--&lt;!&ndash;<div>显示条数<img src="../img/cf_open.png"/></div>&ndash;&gt;-->
	<!--</div>-->
	<div class="listBox">
		<table class="contentslist">
			<thead>
			<tr>
				<!--<th><input type="checkbox" name="" id="" value="" /></th>-->
				<!--<th>编号</th>-->
				<!--<th style="display: block;opacity: 0;">哈克斯</th>-->
				<th>消息标题</th>
				<th>发布时间</th>
				<th>消息类型</th>
				<th>操作</th>
			</tr>
			</thead>
			<tbody>
			<!--<tr>-->
			<!--<td><input type="checkbox" name="" id="" value="" /></td>-->
			<!--<td>10000001</td>-->
			<!--<td style="display: block;opacity: 0;">阿酷</td>-->
			<!--<td>消息推送</td>-->
			<!--<td> 2017-09-23 10：30：23 </td>-->
			<!--<td>系统推送</td>-->
			<!--<td><a href="" class="lookover">查看</a><a href="" class="delect">删除</a></td>-->
			<!--</tr>-->
			<!--<tr>-->
			<!--<td><input type="checkbox" name="" id="" value="" /></td>-->
			<!--<td>10000001</td>-->
			<!--<td style="display: block;opacity: 0;">阿酷</td>-->
			<!--<td>消息推送</td>-->
			<!--<td> 2017-09-23 10：30：23 </td>-->
			<!--<td>系统推送</td>-->
			<!--<td><a href="" class="lookover">查看</a><a href="" class="delect">删除</a></td>-->
			<!--</tr>-->
			</tbody>
		</table>
	</div>

	<div class="" style="text-align: center;height: 75px;padding-top: 17px;margin-bottom: 0;border-top: 1px solid #ebe9ea;">
		<ul class="pagination" id="page1" style="position: static;margin-bottom: 0;"></ul>
		<div class="pageJump">
			<span class="allPageN">1/200</span>
			<i style="margin-left: 12px;">共200页</i>，
			<span>到第</span>
			<input type="text"/>
			<span>页</span>
			<button type="button" class="button">GO</button>
		</div>
	</div>

</div>
<!--</div>-->

<!--<script src="../js/footer.js" type="text/javascript" charset="utf-8"></script>-->
<script src="../js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/swiper.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/common.js?v=201811151239" type="text/javascript" charset="utf-8"></script>
<script src="../js/pager.js" type="text/javascript" charset="utf-8"></script>
<script src="../laydate/laydate.js"></script> <!-- 改成你的路径 -->

<script type="text/javascript" >
    //Iframe 的高度
    $(function () {
        window.parent.$("#Iframe").css("height","922");
    })
    laydate({
        elem: '#test1',
        format: 'YYYY-MM-DD',
        istime: true,
        choose: function(dates){ //选择好日期的回调
//            startTime = dates;
        }
    });
    laydate({
        elem: '#test2',
        format: 'YYYY-MM-DD',
        istime: true,
        choose: function(dates){ //选择好日期的回调
//            startTime = dates;
        }
    });

    $('.objListBox>div:nth-child(5n)').css('margin-right','0');
    Page({
        num: 200,
        elem: $('#page1'),
        callback: function(n) {
            console.log(n);
        }
    });
    $(".searchResultBtn").unbind();
    $(".searchResultBtn").click(function () {
        getData(1);
    })
    getData(1);
    //获取数据
    function getData(currentPage) {
        $(".listBox tbody").html("");
        $.ajax({
            url: pubIP + 'message/getMessageNewsList', /*v1.0*/
            type: 'get',
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            cache: false,
            ansyc: true,
            dataType: 'json',
            data:{
                companyId:"9041805231046330013",
                sort:$(".sort").attr("data-selectedindex"),
                pageSize:pageSize,
                page:currentPage,
                token: token,
                title:$("#msgTitle").val(),
                startTime:$("#test1").val(),
                endTime:$("#test2").val()
            },
            success: function (res) {
                $(".searchResultBtn").css("margin-top","20px")
                if(res.code==1){
                    //首次请求时 改变分页数据
                    if(res.data.length==0){ $(".listBox tbody").html("");$(".pagination").parent().css("display","none"); return;}
                    $(".pagination").parent().css("display","block");
                    if(currentPage==1){
                        //修改底部分页
                        var pageNum=Math.ceil(res.total/pageSize);
                        $(".allPageN").attr("pageTotal",pageNum);
                        $(".pageJump i").text("共"+pageNum+"页,"+"共"+res.total+"条");
                        $('.objListBox>div:nth-child(5n)').css('margin-right','0');
                        Page({
                            num: pageNum,
                            elem: $('#page1'),
                            callback: function(n) {
                                // console.log(n);
                                currentPage=n;
                                getData(n);//加载n页数据
                            }
                        });
                    }
                    //修改底部页数
                    $(".allPageN").text((currentPage)+"/"+ $(".allPageN").attr("pageTotal"));
                    cf_dataRender(res.data)
                }else{
                    alert(res.msg);
                }
            },
            error: function(err){
                console.log(err);
            }
        });
    }
    //渲染数据
    function cf_dataRender(data) {
        var str='';
        $.each(data,function (idx,item) {
            str+='<tr data-id="'+item.id+'">';
            str+='<td>'+item.names+'</td>'
            str+='<td>'+item.addTimeStr+'</td>'
            if(item.type=="0"){
                str+='<td>站内信</td>'
            }else{
                str+='<td>短信</td>'
            }
            str+='<td><a href="" class="lookover">查看</a><a href="" class="delect">删除</a></td>'
            str+='</tr>'
        })
        $(".listBox tbody").html(str);
        //            权限控制
        if(AuthSwitch==1){
            getAuthor11()
        }

        //详情
        $(".seeDetail").click(function () {
            sessionStorage.setItem("detailId",$(this).parent().attr("data-id"));
            window.location.href="./vehicleDetail.html";
        })
        //删除
        $(".delect").click(function () {
            upadtaState(1,this);
        })
    }
    //选择排序方式
    $(".select ul li").click(function () {
        getData(1);
    })
    // 点击go刷新数据
    $('.pageCont').on('click', '.button',function(){
        var currentPage1 = $('.pageCont li.active>a').text();
        currentPage=currentPage1;
        getData(currentPage1);
    })
</script>
</body>
</html>
