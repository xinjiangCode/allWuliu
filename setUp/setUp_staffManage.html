<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" CONTENT="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="format-detection" content="telephone=no" />
    <title>新疆物流服务平台</title>
    <link rel="stylesheet" type="text/css" href="../css/swiper.min.css"/>
    <link rel="stylesheet" type="text/css" href="../css/commin.css"/>
    <link rel="stylesheet" href="../css/setUp_staffManage.css">
	<style>
		.record .Rt div{
			width: 85px;height: 32px;
			border: 1px solid #eceaeb;
			text-align: center;
			line-height: 32px;
			margin-top: 10px;
			margin-left: 6px;
		}
		.btn{
			width: 106px;
			height: 34px;
			line-height: 34px;
			border: 1px solid #d3d3d3;
			text-align: center;
			border-radius: 2px;
			margin-right: 5px;
			margin-top: 8px;
		}
		.select{margin-top: 8px;}
	</style>
</head>
<body>
<!--员工管理-->

    <div class="rightContBox"  style="float: none">
    	<!--头部-->
    	<div class="boxHead">
    		<div class="headLeft">员工管理</div>
    		<!--<div class="headRight cfRefresh">-->
    			<!--<img src="../img/yh_refresh2.png"/>-->
    			<!--<span>刷新</span>-->
    		<!--</div>-->
    	</div>
    	<!--<div class="filtersech">-->
    		<!--<div class="filter1">筛选查询</div>-->
    		<!---->
    		<!--<div class="filter3">查询结果</div>-->
    		<!--<div class="filter2"><input type="checkbox" name="" id="" value="" />收起筛选</div>-->
    	<!--</div>-->
    	<div class="messages">
    		<div class="mesgfirst clearfix"><span class="fl" style="margin-left: 20px; margin-right: 6px;">输入搜索</span><input type="text" class="search_input" placeholder="用户名/账号"></div>
			<div>
				<label for="" style="margin-right: 5px;font-size: 14px;">所属部门</label>
				<div class="goodsType input select" data-selectedindex="0" style="height: 38px;"><span style="margin: 0;padding: 0;">全部</span><img src="../img/prl-select.jpg" >
					<ul class="department_ul">
						<!-- <li data-index="1">待分配订单</li>
						<li data-index="2">进行中订单</li>
						<li data-index="3">完成待审核订单</li>
						<li data-index="3">已完成订单</li> -->
					</ul>
				</div>
			</div>

    		<!-- <div id="mesglast" style="margin-left: 308px;"><label>积分：</label><label style="margin-left: 0;">10000000</label></div> -->
    	</div>
    	<div class="record">
    		<div class="Lf"></div>
			<div class="" style="float: right;">
				<div class="Lf btn add_staff">挂靠员工</div>
				<!-- <div class="Lf btn" style="">新增员工</div> -->
				<div class="select displayNum" data-selectedindex="0"><span>显示条数</span><img src="../img/prl-select.jpg" alt="">
					<ul>
						<li data-index="1">10</li>
						<li data-index="2">20</li>
						<li data-index="3">30</li>
					</ul>
				</div>
				<div class="select displayNum" data-selectedindex="0"><span>排序方式</span><img src="../img/prl-select.jpg" alt="">
					<ul>
						<li data-index="1">10</li>
						<li data-index="2">20</li>
						<li data-index="3">30</li>
					</ul>
				</div>
				<!--<div class="Lf" style="width: 103px;">显示条数<img src="../img/cf_open.png"/></div>-->
				<!--<div class="Lf" style="width: 103px;">排序方式<img src="../img/cf_open.png"/></div>-->

			</div>
    	</div>
    	<div class="listBox">
			<table class="contentslist">
				<thead>
				<tr>
					<th>成员账号</th>
					<th>姓名</th>
					<!--<th style="display: block;opacity: 0;">哈克斯</th>-->
					<th>邮箱地址</th>
					<th>所属角色</th>
					<!-- <th>积分&nbsp;&nbsp;&nbsp;&nbsp;</th> -->
					<th>添加时间&nbsp;&nbsp;&nbsp;&nbsp;</th>
					<th>最后登录&nbsp;&nbsp;&nbsp;&nbsp;</th>
					<th>是否启用</th>
					<th>操作</th>
				</tr>
				</thead>
				<tbody id="staffListInfo">
				<!-- <tr>
					<td>wsinish</td>
					<td>王大力</td>
					<td>37927229272@qq.com</td>
					<td>财务</td>
					<td class="">100000&nbsp;&nbsp;&nbsp;&nbsp;</td>
					<td class="times"><span>2015-09-08</span><span>12 : 30 : 35</span>&nbsp;&nbsp;&nbsp;&nbsp;</td>
					<td class="times"><span>2015-09-08</span><span>12 : 30 : 35</span>&nbsp;&nbsp;&nbsp;&nbsp;</td>
					<td class="chooseswitch">
						<input id="checked_1" type="checkbox" class="switch" />
						<label for="checked_1"></label>
					</td>
					<td><a>分配积分</a> <a class="edits">编辑</a> <a>删除</a></td>
				</tr>
				<tr>
					<td>wsinish</td>
					<td>王大力</td>
					<td>37927229272@qq.com</td>
					<td>财务</td>
					<td class="">100000&nbsp;&nbsp;&nbsp;&nbsp;</td>
					<td class="times"><span>2015-09-08</span><span>12 : 30 : 35</span>&nbsp;&nbsp;&nbsp;&nbsp;</td>
					<td class="times"><span>2015-09-08</span><span>12 : 30 : 35</span>&nbsp;&nbsp;&nbsp;&nbsp;</td>
					<td class="chooseswitch">
						<input id="checked_2" type="checkbox" class="switch" />
						<label for="checked_2"></label>
					</td>
					<td><a>分配积分</a> <a class="edits">编辑</a> <a>删除</a></td>
				</tr> -->
				</tbody>
			</table>
		</div>

		<div class="" style="text-align: center;height: 75px;padding-top: 18px; box-sizing: border-box; margin-bottom: 0;border-top: 1px solid #ebe9ea;">
			<ul class="pagination" id="page1" style="position: static;margin-bottom: 0;"></ul>
			<div class="pageJump">
				<span class="allPageN">1/1</span>
				<i style="margin-left: 12px;">共<span class="total">1</span>页</i>，
				<span>到第</span>
				<input type="text" style="text-align: center; text-indent: 0px;" />
				<span>页</span>
				<button type="button" class="button">GO</button>
			</div>
		</div>
    </div>
<!--</div>-->

<!--<script src="../js/footer.js" type="text/javascript" charset="utf-8"></script>-->
<script src="../js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/swiper.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/pager.js" type="text/javascript" charset="utf-8"></script>


<script type="text/javascript" >
    //Iframe 的高度
    $(function () {
        window.parent.$("#Iframe").css("height","932");

        window.sessionStorage.setItem('person_id', '');

    })
    $('.objListBox>div:nth-child(5n)').css('margin-right','0');
    // Page({
    //     num: 200,
    //     elem: $('#page1'),
    //     callback: function(n) {
    //         console.log(n);
    //     }
    // });


    $('.search_input').change(function() {

    	staff_list(1, 10, $(this).val(), '');
    });

    department_select();

    function department_select() {
    	$.ajax({
            url: pubIP + 'receptionDepartment/querySelectList',
            type: 'get',
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            cache: false,
            dataType: 'json',
            success: function (json) {
                console.log(json);
                if (json.code == 1) {
                    if (json.data.length != 0) {
                        var str = '<li>全部</li>';
                        for (var i = 0; i < json.data.length; i++) {
                            str += '<li data-departmentId="'+json.data[i].key+'">'+json.data[i].value+'</li>'
                        }

                        $('.department_ul').html(str);

                        $('.select ul li').click(function(){
                            event.stopPropagation();
                            $(this).parent().parent().attr('data-selectedindex', $(this).attr('data-departmentId'));
                            $(this).parent().parent().find('span').text($(this).text());
                            $(this).parent().parent().children('img').attr('src', 'img/prl-select.jpg')
                            $(this).parent().css('display','none');

                            if ($(this).text() == '全部') {
                            	staff_list(1, 10, '', '');	
                            } else {
                            	staff_list(1, 10, '', $(this).text());
                            }
                            

                        });
                    }
                }
                
            },
            error: function(err) {
                console.log(err);
            }
        });
    }

    // $('.department_ul');

    // 添加员工
    $(document).on('click', '.add_staff', function() {
    	window.location.href = "setUp_addpersonnel.html";
    });

    var isFirst = true;

    var isSearch = 0;

    staff_list(1, 10, '', '');

    // 员工列表
    function staff_list(num, size, name, department) {
        $('#staffListInfo').html('');
        $.ajax({
            url: pubIP + 'tReceptionDepartmentPersion/queryList',
            type: 'post',
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            data: {
                page: num,
                size: size,
                name: name,
                department: department 
            },
            cache: false,
            dataType: 'json',
            success: function (json) {
                console.log(json);

                if (json.code == 1) {
                    if (json.data.length != 0) {
                    	var str = '';
                        for (var i = 0; i < json.data.length; i++) {
                        
                            json.data[i].createTime = new Date(json.data[i].createTime).Format("yyyy-MM-dd");
                            json.data[i].updateTime = new Date(json.data[i].updateTime).Format("yyyy-MM-dd");

                            str += '<tr data-id="'+json.data[i].id+'">'
								+'<td>'+json.data[i].username+'</td>'
								+'<td>'+json.data[i].name+'</td>'
								+'<td>'+json.data[i].email+'</td>'
								+'<td>'+json.data[i].roleName+'</td>'
								+'<td class="times">'+json.data[i].createTime+'</td>'
								+'<td class="times">'+json.data[i].updateTime+'</td>'
								+'<td class="chooseswitch">'
									if (json.data[i].status == '0') {
										str += '<input id="checked_'+i+'" type="checkbox" class="switch" checked=""/>'
										+'<label for="checked_'+i+'"></label>'
									} else if (json.data[i].status == '1') {
										str += '<input id="checked_'+i+'" type="checkbox" class="switch" />'
										+'<label for="checked_'+i+'"></label>'
									}
								str += '</td>'
								+'<td><a href="javascript:;" class="edits">编辑</a> <a href="javascript:;" class="delete">删除</a></td>'
							+'</tr>';

                        }
						
                        $('#staffListInfo').html(str);

                        // var result = template('apartmentListTpl', {list: json.data});
                        // $('#apartmentListInfo').html(result);


                        //启用和禁用
						$(".chooseswitch input[type='checkbox']").change(function() {
						    console.log($(this).prop("checked"));
						    
						    if($(this).prop("checked")){
						        status_staff($(this).parent().parent().attr('data-id'), 0);
						    }else {
						        status_staff($(this).parent().parent().attr('data-id'), 1);
						    }
						});

                       //  totalPage = json.count%size == 0 ? totalPage : (totalPage + 1);
                       // console.log(totalPage);
                        if (isSearch == 1) {
                            // if (isFirst) {

                                Page({
                                    num: json.totalPage,
                                    elem: $('#page1'),
                                    callback: function(n) {
                                        apartment_list(n, size);
                                    }
                                });
                                
                                $('.total').text(json.totalPage);
                                isFirst = false;

                            // }

                            $('.allPageN').text(num+1+'/'+json.totalPage);
                        }

                        isSearch = 0;

                        if (isFirst) {

                            Page({
                                num: json.totalPage,
                                elem: $('#page1'),
                                callback: function(n) {
                                    apartment_list(n, size);
                                }
                            });
                            
                            $('.total').text(json.totalPage);

                            isFirst = false;
                        }

                        $('.allPageN').text(num+'/'+json.totalPage);
                    } else {
                        $('.pageJump').css('display', 'none');    
                    }
                } else {
                    $('.pageJump').css('display', 'none');
                }

            },
            error: function (err) {
                console.log(err);
            }

        });
    }

    // 编辑
    $(document).on('click', '.edits', function() {
        window.sessionStorage.setItem('person_id', $(this).parent().parent().attr('data-id'));
        window.location.href = "setUp_addpersonnel.html";
    });



    function status_staff(data_id, status) {
        $.ajax({
            url: pubIP + 'tReceptionDepartmentPersion/updateWLDepartmentPersion',
            type: 'post',
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            data: {
                id: data_id,
                status: status
            },
            cache: false,
            dataType: 'json',
            success: function (json) {
                console.log(json);
                if (json.code == 1) {
                    cf_alert(1, '修改成功！');
                }
            },
            error: function(err) {
                console.log(err);
            }
        });
    }

    // 删除 
    $(document).on('click', '.delete', function() {

        window.parent.warn_alert($(this).parent().parent().attr('data-id'), '是否确认要删除？');

    });

    // 删除
    window.parent.$('.all_sure').unbind();
    // $(window.parent.document).on('click', '.all_sure', function() {
    window.parent.$('.all_sure').click(function() {

        del($(this).attr('data-this'));

    })

    function del(data_id) {
        $.ajax({
            url: pubIP + 'tReceptionDepartmentPersion/delDepartmentPersion',
            type: 'post',
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            data: {
                id: data_id
            },
            dataType: 'json',
            success: function (json) {
                if (json.code == 1) {
                    cf_alert(1, '删除成功！');
                } else if (json.code == -1) {
                    cf_alert(2, json.msg);
                }

            },
            error: function(err) {
                console.log(err);
            }
        });
    }
</script>
</body>
</html>
