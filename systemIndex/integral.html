<!--积分兑换记录-->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" CONTENT="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="format-detection" content="telephone=no" />
    <title adct="2">新疆物流服务平台</title>
    <link rel="stylesheet" type="text/css" href="../css/swiper.min.css"/>
    <link rel="stylesheet" type="text/css" href="../css/commin.css"/>
    <link rel="stylesheet" type="text/css" href="../css/integral.css"/>
    <style>

    </style>



</head>
<body>
<div class="container">
    <div class="containerTitle">
        积分兑换记录
    </div>
    <div class="containerTop">
        <div class="containerTopLe Lf">

            <div class="containerTopLe1 Lf" style="margin-left: 60px;">
                <div class="containerTopLeImg Lf">
                    <img src="../img/cf_integral1.png" alt="">
                </div>
                <div class="Lf">
                    <div style="font-size: 30px;color: #F66132;" id="memberIntegralBefore"></div>
                    <div style="font-size: 14px;">总积分</div>
                </div>
            </div>
            <div class="containerTopLe1 Lf" style="margin-left: 60px;">
                <div class="containerTopLeImg Lf">
                    <img src="../img/cf_integral2.png" alt="">
                </div>
                <div class="Lf">
                    <div style="font-size: 30px;color: #7CBA3F;" id="integral"></div>
                    <div style="font-size: 14px;">可用积分</div>
                </div>
            </div>
            <!--<div class="containerTopLe1 Lf">-->
            <!--<div class="containerTopLeImg Lf">-->
            <!--<img src="../img/cf_integral3.png" alt="">-->
            <!--</div>-->
            <!--<div class="Lf">-->
            <!--<div style="font-size: 30px;color: #6EA3FF;">600</div>-->
            <!--<div style="font-size: 14px;">已分配积分</div>-->
            <!--</div>-->
            <!--</div>-->


        </div>

        <div class="containerTopRi  Lf">
            <div style="font-size: 16px;color: #282828;margin-bottom: 20px;">
                <img src="../img/cf_laba.png" alt="">
                温馨提示:
            </div>
            <div style="color: #838383;font-size: 12px;line-height: 22px;">XSHSIH化工平台为回馈会员，特别推出的会员积分。
                会员可将账户内累计的积分用于兑换积分平台上推出
                的相关产品和增值服务。</div>
        </div>
    </div>
    <div class="jifenNav" style="overflow: hidden;">
        <div class="Lf on" data-id="" style="margin-left: 29px;cursor: pointer;">积分记录</div>
        <div class="Lf" data-id="2" style="cursor: pointer;">兑换记录</div>
    </div>

    <div class="jifenjilu listBox" style="height: 576px;min-height: 576px;">
        <table>
            <thead>
            <tr>
                <td style="width: 220px;">时间</td>
                <!--<td style="width: 90px;"></td>-->
                <td style="width: 274px;">行为</td>
                <!--<td style="width: 90px;"></td>-->
                <td>积分数</td>
                <!--<td style="width: 120px;"></td>-->
                <td>操作用户</td>
            </tr>
            </thead>
            <tbody >
            <!--<tr>-->
            <!--<td style="color: #666666;">2018-01-02 10:02:30</td>-->
            <!--<td></td>-->
            <!--<td><i class="jifenSta green">完成任务</i>成功注册账户，获得积分：<i style="color: #f97646;">1</i></td>-->
            <!--<td></td>-->
            <!--<td class="jifenNum">+1</td>-->
            <!--<td></td>-->
            <!--<td>张三</td>-->
            <!--</tr>-->
            <!--<tr>-->
            <!--<td style="color: #666666;">2018-01-02 10:02:30</td>-->
            <!--<td></td>-->
            <!--<td><i class="jifenSta green">完成任务</i>成功注册账户，获得积分：<i style="color: #f97646;">1</i></td>-->
            <!--<td></td>-->
            <!--<td class="jifenNum">+1</td>-->
            <!--<td></td>-->
            <!--<td>张三</td>-->
            <!--</tr>-->
            </tbody>
        </table>
    </div>
    <div class="" style="text-align: center;height: 75px;padding-top: 17px;margin-bottom: 0;border-top: 1px solid #ebe9ea;">
        <ul class="pagination" id="page1" style="position: static;margin-bottom: 0;"></ul>
        <div class="pageJump">
            <span class="allPageN">1/200</span>
            <i style="margin-left: 12px;">共200页</i>，
            <span>到第</span>
            <input type="text"/>
            <span>页</span>
            <button type="button" class="button">GO</button>
        </div>
    </div>

</div>



<script src="../js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/swiper.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/pager.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>


<script type="text/javascript" >
    //Iframe 的高度
    $(function () {
        window.parent.$("#Iframe").css("height","1010");
    })
    $('.objListBox>div:nth-child(5n)').css('margin-right','0');
    Page({
        num: 200,
        elem: $('#page1'),
        callback: function(n) {
            console.log(n);
        }
    });
    $(".cfnav").click(function () {
        $(".cfnav").removeClass("on");
        $(this).addClass("on");
    })
    $(".jifenNav>div").click(function () {
        $(".jifenNav>div").removeClass("on");
        $(this).addClass("on");
        getData(1);
    })
    getJiFen();
    getData(1);
    //获取数据
    function getData(currentPage) {
        $(".listBox tbody").html("");
        $.ajax({
            url: pubIP + 'userInfo/JfUserInfo', /*v1.0*/
            type: 'post',
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            cache: false,
            ansyc: true,
            dataType: 'json',
            data:{
                iDisplayStart:currentPage,
                iDisplayLength:pageSize,
                startTime:'',
                endTime:'',
                integralType:$(".jifenNav .on").attr("data-id"),
            },
            success: function (res) {
                //首次请求时 改变分页数据
                if(res.aData.length==0){ $(".listBox tbody").html("");$(".pagination").parent().css("display","none"); return;}
                $(".pagination").parent().css("display","block");
                if(currentPage==1){
                    //修改底部分页
                    var pageNum=Math.ceil(res.iTotalRecords/pageSize);
                    $(".allPageN").attr("pageTotal",pageNum);
                    $(".pageJump i").text("共"+pageNum+"页,"+"共"+res.iTotalRecords+"条");
                    $('.objListBox>div:nth-child(5n)').css('margin-right','0');
                    Page({
                        num: pageNum,
                        elem: $('#page1'),
                        callback: function(n) {
                            // console.log(n);
                            getData(n);//加载n页数据
                        }
                    });
                }
                //修改底部页数
                $(".allPageN").text((currentPage)+"/"+ $(".allPageN").attr("pageTotal"));
                cf_dataRender(res.aData)
            },
            error: function(err){
                console.log(err);
            }
        });
    }

    function cf_dataRender(list) {
        console.log(list)
        var str="";
        $.each(list,function (idx,item) {
            item.userName=item.userName==null?"":item.userName
            item.score=item.score==null?"":item.score;
            item.score=item.score==null?"0":item.score;
            item.time=item.time==null?"":timestampToTime1(item.time);

            str+='<tr>'
            str+='<td style="color: #666666;">'+item.time+'</td>'
            str+='<td><i class="jifenSta green" style="display: none;">'+item.source+'</i>'+item.source+'<i style="color: #f97646;">'+item.score+'</i></td>'
            str+='<td class="jifenNum">'+item.score+'</td>'
            str+='<td>'+item.userName+'</td>'
            str+='</tr>'
        })
        $(".listBox tbody").html(str)
    }

    function getJiFen() {
        $.ajax({
            url: pubIP + 'userInfo/mainUserIntegralInfo', /*v1.0*/
            type: 'post',
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            cache: false,
            ansyc: true,
            dataType: 'json',
            data:{

            },
            success: function (res) {
                if(res.code=="0"){
                    $("#integral").text(res.data.integral==null?"0":res.data.integral)
                    $("#memberIntegralBefore").text(res.data.memberIntegralBefore==null?"0":res.data.memberIntegralBefore)
                }else{
                    cf_alert01(2,res.msg)
                }
            },
            error: function(err){
                console.log(err);
            }
        });
    }
</script>
</body>
</html>







