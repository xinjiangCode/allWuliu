<!--账户 特殊资质认证-->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" CONTENT="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="format-detection" content="telephone=no" />
    <title adct1="1">新疆化学品经营服务平台</title>
    <link rel="stylesheet" type="text/css" href="../css/commin.css"/>
    <link rel="stylesheet" type="text/css" href="../css/Special1.css"/>
    <style type="text/css">
        .container {
            height: 725px;
        }

        .bottom1>.shenhe {
            width: 107px;
            height: 40px;
            line-height: 40px;
            background-color: white;
            color: #666666;
            border: 1px solid #666666;
            margin-left: 10px;
            margin-top: 0;
            background: #ccc;
        }

        .laydate-icon {
            border: 1px solid #C6C6C6;
            /* padding-right: 16px; */
            /* margin-right: 0px; */
            background-image: url(../../../img/yh_rili.png);
            background-position: 137px;
            background-size: 11%;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="containerTitle">
        <div class="Lf">企业资质审核</div>
        <div class="Rt cfRefresh" style="width: 90px;height: 35px;border: 1px solid #f1f1f1;line-height: 35px;margin-top: 8px;"><img style="margin: 12px 5px 0 15px;" src="../img/cf_shuaxin.png" alt="">刷新</div>
    </div>
    <div class="header">
        <ul>
            <li>
                <a href="./Special1.html" style="color: #007aff;">
                    危险化学品认证
                </a>
            </li>
            <li class="headerLIne"></li>
            <li>
                <a href="javascript:;" style="color: #999999;">
                    特殊资质认证
                </a>
            </li>
            <li class="headerLIne"></li>
            <li>
                <a href="./Special3.html" style="color: #999999;">
                    其他资质信息
                </a>
            </li>
        </ul>
    </div>
    
    <div id="center">
        <div class="center1 c0">
            <ul>
                <li class="clearfix">
                    <div class="left1 Lf"><i class="red">*</i>资质类型:</div>
                    <div class="right1 Lf">
                        <div class="select zizhi_type zizhi_type0" id="zizhi_type0" data-selectedindex="">
                            <span></span>
                            <img src="../img/prl-select.jpg" alt="">
                            <ul>
                                <li data-index="1">10</li>
                                <li data-index="2">20</li>
                                <li data-index="3">30</li>
                            </ul>
                        </div>
                        <!--<select name="" class="zizhi_type zizhi_type0" id="zizhi_type0">-->

                        <!--</select>-->
                    </div>
                </li>
                <li class="clearfix">
                    <div class="left1 Lf"><i class="red">*</i>资质编号:</div>
                    <div class="right1 Lf"><input type="text" class="zizhi_num" id="zizhi_num0"></div>
                    <span class="ts">资质编号必须为数字</span>
                </li>

                <li   style="overflow: visible;" class="clearfix">
                    <div class="left1 Lf"><i class="red">*</i>许可经营范围:</div>
                    <div class="right1 Lf">
                        <div name="" id="textarea0" class="textarea"  style="width: 359px;height: 88px;" contenteditable="true" ></div>
                    </div>
                    <span class="ts" style="margin-top: 32px;">许可经营不能为空</span>
                    <div class="btn1 Lf" style="color: #999999;font-size: 14px;"><img style="width: 20px;height: 20px;" src="../img/cf_add.png" alt="">添加</div>

                    <div class="none">
                        <div class="sousuo_div">
                            <input type="text" id="" class="input_width">
                            <img src="../img/sousuo.png" class="sousuo_img" alt="">
                            <span class="sousuo">搜索</span>
                        </div>
                        <div class="cousuo_cont">
                            <ul class="sousuo_ul">
                                
                            </ul>
                        </div>
                    </div>
                </li>
                <li class="clearfix">
                    <div class="left1 Lf"><i class="red">*</i>有效期:</div>
                    <div class="right1 Lf">
                        <input type="text" class="date-input laydate-icon kuang start" style="" placeholder="请选择日期" id="test1">
                        <span style="height: 38px;line-height: 38px;">&nbsp;至&nbsp; </span>
                        <input type="text" class="date-input laydate-icon kuang end" style="" placeholder="请选择日期" id="test2">
                    </div>
                    <span class="ts">有效期不能为空</span>
                </li>
                <li class="clearfix" style="position: relative;">
                    <div class="left1 Lf"><i class="red">*</i>资质图片:</div>
                    <div class="right1 Lf pic_div">
                        <div class="uploade" style="float: left;">
                            <i style=""></i>
                            <img src="../img/list_logo.png" alt="" class="preview pic1" id="uploade_preview0">
                            <input type="file" class="input_blur" onchange="xmTanUploadImg(this);">
                            <input type="hidden" class="hd0" id="hidden">
                        </div>
                        <div class="ts1">至少添加一张图片</div>
                        <a href="##" class="add_pic add_pic1" data-pic="pic" style="float: left;font-size: 14px; position: absolute; bottom: 0px;">继续添加图片</a>
                    </div>

                </li>
            </ul>
            <i class="red" style="display: block;margin-top: 22px;font-size: 14px;margin-left: 155px;">请上传资质证书照片或者扫描件！ 照片大小 < 2MB</i>
        </div>
    </div>
    

    <div class="bottom1">
        <div class="btn Lf add add1">继续添加其他资质</div>
        <div class="btn Lf sub">提交</div>
        <div class="btn Lf shenhe" style="display: none;">审核中</div>
    </div>

    
</div>

<script src="../js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>

<script src="../laydate/laydate.js"></script> <!-- 改成你的路径 -->
<script type="text/javascript">
    //Iframe 的高度
    $(function () {
        window.parent.$("#Iframe").css("height","725");
    })

   var startTime1 = '';
    var endTime1 = '';
    var isSelect=false;

    laydate({
        elem: '#test1',
        format: 'YYYY-MM-DD',
        istime: false,
        choose: function(dates){ //选择好日期的回调
            $("#test1").parent().next().css('display', 'none');
            startTime1 = dates;
        }
    })
    laydate({
        elem: '#test2',
        format: 'YYYY-MM-DD',
        istime: false,
        choose: function(dates){ //选择好日期的回调
            $("#test2").parent().next().css('display', 'none');
            endTime1 = dates;
        }
    })

    function lay(id) {
        laydate({
            elem: '#'+id,
            format: 'YYYY-MM-DD',
            istime: false,
            choose: function(dates){ //选择好日期的回调
                $("#"+id).parent().next().css('display', 'none');
                /*endTime1 = dates;*/
            }
        })
    }

    //不同浏览器下的路径不同
    function getObjectURL(file) {
        var url = null;
        if (window.createObjectURL != undefined) { // basic

            url = window.createObjectURL(file);

        } else if (window.URL != undefined) { // mozilla(firefox)

            url = window.URL.createObjectURL(file);

        } else if (window.webkitURL != undefined) { // webkit or chrome

            url = window.webkitURL.createObjectURL(file);
        }

        return url;
    }

    //选择图片，马上预览
    function xmTanUploadImg(obj) {
        var file = obj.files[0];

        if (file.size >= 2097152) {
            alert('上传的图片超过了2MB');
            return;
        }

        //添加图片路径到img src中进行预览
        $(obj).prev().attr('src', getObjectURL(file));

        var formdata=new FormData();

        var c = $(obj).prev()[0];
        var path = $(c).attr('src');

        formdata.append('file', file);
        
        formdata.append('path', path);
    

        $.ajax({
            url: uplodImgPath,
            type: 'post',
            processData: false,  // 告诉jQuery不要去处理发送的数据
            contentType: false,   // 告诉jQuery不要去设置Content-Type请求头
            data: formdata,
            cache: false,
            dataType: 'json',
            success: function (data) {
                // console.log(data);
                /*img_url1 = data.url;*/
                $(obj).prev().attr('src', data.url);
                $(obj).next().val(data.url);
                $(obj).prev().attr('data-flag', '0');
            },
            error: function (err) {
                console.log(err);
            }
        });

    }

    $(function(){


        $('.header ul li:nth-child(3) a').on('click', function () {
            
            $.ajax({
                url: pubIP + 'companyCertification/getQualificationsStateByCompanyId',
                type: 'post',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                data: {
                    companyId: companyId
                },
                cache: false,
                dataType: 'json',
                success: function (data) {
                    console.log(data);
                    if (data.data == 'false') { 
                        
                            window.parent.tan1();   
                        // } else {
                        //     window.parent.tan2();
                        // }
                        
                    } else {
                        location.href="Special2.html";
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });

            
        });


        $('.laydate-icon').css({
            'backgroundImage': 'url(../img/yh_rili.png)',
            'backgroundPosition': '137px',
            'backgroundSize': '11%'
        });
    

    
        searchAjax();

   

        function typeAjax() {
            $.ajax({
                url: pubIP + 'companyCertification/getQualificationTypeList',
                type: 'post',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                data: {
                    type: 0
                },
                cache: false,
                dataType: 'json',
                success: function (data) {
                    console.log(data);

                    var str = '';
                    for (var i = 0; i < data.data.length; i++) {
                        str += '<li  data-index="'+i+'" value="'+data.data[i].ids+'" data-ids="'+data.data[i].ids+'">'+data.data[i].typeName+'</li>';
                        if($("#zizhi_type0").attr("disabled")=="disabled"){

                        }else{
                            if(i==0){
                                $("#zizhi_type0").attr("data-selectedindex","0");
                                $("#zizhi_type0 span").text(data.data[i].typeName);
                                $("#zizhi_type0 span").attr("data-spanvalue",data.data[i].ids);
                            }
                        }
                    }

//                    $('.zizhi_type').each(function(){
//                        $(this).html(str);
//                    });

                   $('.zizhi_type ul').html(str);

                    $('.select ul li').click(function(){
                        event.stopPropagation();
                        $(this).parent().parent().attr('data-selectedindex', $(this).attr('data-index'));
                        $(this).parent().parent().find('span').text($(this).text());
                        $(this).parent().parent().children('img').attr('src', '../img/prl-select.jpg')
                        $(this).parent().css('display','none');
                    });
                    searchAjax();           
                    
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }


    
        var isfirst = true;
        function searchAjax() {
            $.ajax({
                url: pubIP+'companyCertification/getQualificationsBaseInfoAndStrByCompanyId',
                type: 'post',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                data: {
                    companyId: companyId,
                    type: 0
                },
                cache: false,
                dataType: 'json',
                success: function (data) {
                    console.log(data);

                    if(isfirst){
                        for (var i = 0; i < data.data.length; i++) {
                            if(i > 0){
                                $('.add').click();
                                $('.laydate-icon').css({
                                    'backgroundImage': 'url(../img/yh_rili.png)',
                                    'backgroundPosition': '137px',
                                    'backgroundSize': '11%'
                                });
                            }
                            for (var j = 0; j < data.data[i].picInfos.length-1; j++) {
                                $('.c'+i+' .add_pic').click();

                            }
                        }
                        typeAjax();
                        isfirst = false;
                        return false;
                    }


                    console.log(data.data)
                    for (var i = 0; i < data.data.length; i++) {

                        $('.c'+i).attr('data-qiyeId', data.data[i].ids);
                       
                        //资质类型
//                        $('#zizhi_type'+i+' option[value="'+data.data[i].qualificationType+'"]').attr("selected",true);
                        $('#zizhi_type'+i).find("span").text(data.data[i].qualificationName)
                        $('#zizhi_type'+i).find('span').attr("data-spanvalue",data.data[i].qualificationTypeIds)
                        $('#zizhi_type'+i).attr('disabled', "disabled").css("background-color","#ddd");
                        
                        //资质编号
                        $('#zizhi_num'+i).val(data.data[i].qualificationNum);
                        $('#zizhi_num'+i).attr('readonly', 'readonly').css("background-color","#ddd");

                        //资质图片
                        for (var j = 0; j < data.data[i].picInfos.length; j++) {
                            $('.c'+i+' .pic'+(j+1)).attr('data-picids', data.data[i].picInfos[j].ids);
                            $('.c'+i+' .pic'+(j+1)).attr('src', data.data[i].picInfos[j].picUrl);
                            $('.c'+i+' .pic'+(j+1)).attr('data-flag', '0');
                        }
                        //不让点击添加图片
                        $(".add_pic").hide();

                        data.data[i].qualificationDataBegin = new Date(data.data[i].qualificationDataBegin).Format("yyyy-MM-dd");

                        data.data[i].qualificationDataExpire = new Date(data.data[i].qualificationDataExpire).Format("yyyy-MM-dd");

                        //许可经营范围
                        $('#textarea'+ i).attr('data-textarea', data.data[i].operationLimit);
                        //不让添加
                        $(".btn1").hide();
                        

                        /*var arr = data.data[i].operationLimit.split(';')*/
                        
                        //时间
                        $('.c'+i+ ' .start').val(data.data[i].qualificationDataBegin).attr('disabled', "disabled").css("background-color","#ddd");
                        $('.c'+i+ ' .end').val(data.data[i].qualificationDataExpire).attr('disabled', "disabled").css("background-color","#ddd");

                        $('.c'+i).append('<div class="btn edit_btn" style="width: 82px;height: 30px;line-height: 30px;margin: 45px 0 0 298px;">编辑</div>');

                    }
                    $('.textarea').each(function(){
                        $(this).attr('display',true)
                        var that = this;
                        var idArr =  $(this).attr('data-textarea');
                        if (idArr) {
                            idArr = idArr.split(';');
                            $(this).attr('contenteditable', 'false');
                            $.each(idArr,function(i,t){
                                if(t!=''){
                                    sousuoAjax(t, function(a) {
                                       /* console.log($(that))*/
                                        $(that).append('<div data-ind="'+idArr[i]+'">'+a + '</div>');
                                        
                                    });
                                }
                            
                            });
                        }
                        
                    });

                    stateAjax();
                },
                error: function (err) {
                    console.log(err);
                }
            });



        }


        function sousuoAjax(chemicalIds ,func) {

            $.ajax({
                url: pubIP + 'productApi/getChemicalInfoById',
                type: 'get',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                data: {
                    chemicalId: chemicalIds
                },
                cache: false,
                dataType: 'json',
                success: function (data) {
                    /*console.log(data);*/
                    if (func) {
                        func(data.data.chemicalName);
                    }

                },
                error: function (err) {
                    console.log(err);
                }
            });
        }


        $(document).on('click', '.edit_btn', function() {
            
           $(this).parent().find('.zizhi_type').attr('disabled', false).css("background-color","#fff");
            isSelect=true;

            $(this).parent().find('.zizhi_num').attr('readonly', false).css("background-color","#fff");;
           // $(this).parent().find('.textarea').attr('contenteditable', true);
           $(this).parent().find(".add_pic").show().css('display', 'inline-block');
           $(this).parent().find(".btn1").show();
           $(this).parent().find(".start").attr('disabled', false).css("background-color","#fff");
           $(this).parent().find(".end").attr('disabled', false).css("background-color","#fff");

        });


        function stateAjax() {

            $.ajax({
                url: pubIP + 'companyCertification/getQualificationStateByCompanyId',
                type: 'post',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                data: {
                    companyId: companyId
                },
                cache: false,
                dataType: 'json',
                success: function (data) {
                    console.log("+++++++++++++++");
                    console.log(data);
                    if(data.data==null){
                        return;
                    }
                    //未审核
                    if (data.data.aType == 0 && data.data.aState == 0) {
                        //window.parent.shenhe();  
                        $(".sub").hide();
                        $(".shenhe").show();
                        $('.btn.edit_btn').css('display', 'none');
                        $('.sub').attr('disabled', true);
                        $('.quxiao_add').css('display', 'none');
                        $('.shou_pic').css('display', 'none');

                    } else if (data.data.aType == 0 && data.data.aState == 2) {  //已拒绝
                        window.parent.jujue_weixian(data.data.refuseReason); 
                        $(".shenhe").hide();
                        $('.btn.edit_btn').css('display', 'block');
                        $('.sub').attr('disabled', false);
                        $('.quxiao_add').css('display', 'block');
                        $('.shou_pic').css('display', 'block');
                    }else {
                        $('.btn.edit_btn').css('display', 'block');
                        $('.sub').attr('disabled', false);
                        $('.quxiao_add').css('display', 'block');
                        $('.shou_pic').css('display', 'block');
                        $(".shenhe").hide();
                        $(".sub").show();
                    }

                },
                error: function(err) {
                    console.log(err);
                }

            });

        }

    


    
        var ind;

        $(document).on('click', '.add_pic', function() {
            var pic = $(this).attr('data-pic');

            var cla = $(this).prev().prev().find('img').attr('class');

           /* console.log(cla);*/

            ind = Number(cla.substr(11));
           /* console.log(ind);*/
            if (ind < 10) {

                ind++;
                var str =   '<div class="uploade" style="float: left;">'
                                +'<i style=""></i>'
                                +'<img src="../img/list_logo.png" alt="" class="preview '+(pic+ind)+'" id="uploade_preview'+(ind-1)+'">'
                                +'<input type="file" class="input_blur" onchange="xmTanUploadImg(this);">'
                                +'<input type="hidden" class="hd'+pic+'" id="hidden">'
                            +'</div>';

                $(this).parent().find('.ts1').before(str); 

            } else {
                $(this).html('最多只能添加十张');
            }

        });


       
    var j = 3;
    var i = 1;
    var p = 1;
    $(document).on('click', '.add', function () {

        var center1 = 2 * Number($('.center1').length);

        var str = '<div class="center1 c'+i+'">'
                +'<div class="clearfix quxiao_div"><span class="quxiao_add">取消添加</span><img class="shou_pic" src="../img/search_shou.png"></div>'
                +'<ul>'
                    +'<li>'
                        +'<div class="left1 Lf"><i class="red">*</i>资质类型:</div>'
                        +'<div class="right1 Lf">'
//                            +'<select name="" class="zizhi_type zizhi_type'+i+'" id="zizhi_type'+i+'">'
//
//                            +'</select>'
                            +'<div class="select zizhi_type zizhi_type'+i+'" id="zizhi_type'+i+'" data-selectedindex='+i+' value="">'
                                +'<span></span>'
                                +'<img src="../img/prl-select.jpg" alt="">'
                                +'<ul></ul>'
                            +' </div>'
                        +'</div>'
                    +'</li>'
                    +'<li>'
                        +'<div class="left1 Lf"><i class="red">*</i>资质编号:</div>'
                        +'<div class="right1 Lf"><input type="text"  class="zizhi_num" id="zizhi_num'+i+'"></div>'
                        +'<span class="ts">资质编号必须为数字</span>'
                    +'</li>'
                    +'<li style="overflow: visible;" class="clearfix">'
                        +'<div class="left1 Lf"><i class="red">*</i>许可经营范围:</div>'
                        +'<div class="right1 Lf">'
                            +'<div name="" id="textarea'+i+'" class="textarea"  style="width: 359px;height: 88px; border: 1px solid #ebe9ea;"  contenteditable="false"></div>'
                        +'</div>'
                        +'<span class="ts2">许可经营不能为空</span>'
                        +'<div class="btn1 Lf" style="color: #999999;font-size: 14px;"><img style="width: 20px;height: 20px;" src="../img/cf_add.png" alt="">添加</div>'
                        +'<div class="none">'
                            +'<div class="sousuo_div">'
                                +'<input type="text" id="" class="input_width">'
                                +'<img src="../img/sousuo.png" class="sousuo_img" alt="">'
                                +'<span class="sousuo">搜索</span>'
                            +'</div>'
                            +'<div class="cousuo_cont">'
                                +'<ul class="sousuo_ul">'
                                    
                                +'</ul>'
                            +'</div>'
                        +'</div>'
                    +'</li>'
                    +'<li>'
                        +'<div class="left1 Lf"><i class="red">*</i>有效期起:</div>'
                        +'<div class="right1 Lf huoqu_date">'
                            +'<input type="text" class="date-input laydate-icon kuang start"  placeholder="请选择日期" onclick="lay(this.id)" id="test'+(center1 + 1)+'">'
                            +'<span style="height: 38px;line-height: 38px;">&nbsp; 至&nbsp; </span>'
                            +'<input type="text" class="date-input laydate-icon kuang end"  placeholder="请选择日期" onclick="lay(this.id)" id="test'+(center1 + 2)+'">'
                        +'</div>'
                        +'<span class="ts">有效期不能为空</span>'
                    +'</li>'
                    +'<li style="position:relative;">'
                        +'<div class="left1 Lf"><i class="red">*</i>资质图片:</div>'
                        +'<div class="right1 Lf pic_div">'
                            +'<div class="uploade" style="float: left;">'
                                +'<i style=""></i>'
                                +'<img src="../img/list_logo.png" alt="" class="preview pic1" id="uploade_preview0">'
                                +'<input type="file" class="input_blur" onchange="xmTanUploadImg(this);">'
                                +'<input type="hidden" class="hd0">'
                            +'</div>'
                            +'<div class="ts1">至少添加一张图片</div>'
                            +'<a href="##" class="add_pic" data-pic="pic" style="float: left;font-size: 14px; position: absolute; bottom: 0px;">继续添加图片</a>'
                        +'</div>'
                    +'</li>'
                +'</ul>'
                +'<i class="red" style="display: block;margin-top: 22px;font-size: 14px;margin-left: 155px;">请上传资质证书照片或者扫描件！ 照片大小 < 2MB</i>'
            +'</div>';

        $('#center').append(str);
        i++;
        /*typeAjax();*/


        $.ajax({
            url: pubIP + 'companyCertification/getQualificationTypeList',
            type: 'post',
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            data: {
                type: 0
            },
            cache: false,
            dataType: 'json',
            success: function (data) {
                console.log(data);

                var str = '';
                for (var i = 0; i < data.data.length; i++) {

                    str += '<li data-index="'+i+'" value="'+data.data[i].ids+'" data-ids="'+data.data[i].ids+'">'+data.data[i].typeName+'</li>';
                    if(i==0){
                        $('.zizhi_type'+(p)).attr("data-selectedindex","0");
                        $('.zizhi_type'+(p)).find('span').attr("data-spanvalue",data.data[i].ids);
                        $('.zizhi_type'+(p)).find("span").text(data.data[i].typeName);
                    }

                }

                $('.zizhi_type'+(p)).find("ul").html(str);



                // 模拟下拉框
                $('.zizhi_type'+(p)).click(function(event){

                    if($(this).attr("disabled")=="disabled"){ //判断是否可以点击
                        return;
                    }

                    if($(this).children('img').attr('src') == '../img/prl-selected.jpg'){
                        $(this).children('img').attr('src', '../img/prl-select.jpg')
                    } else {
                        $(this).children('img').attr('src', '../img/prl-selected.jpg')
                    }

                    event.stopPropagation();

                    $(this).children('ul').toggle();
                    var that = $(this);
                    that.find('li').each(function(){
                        $(this).mouseover(function(){
                            $(this).addClass('hovered')
                        });
                        $(this).mouseleave(function(){
                            $(this).removeClass('hovered')
                        });
                        if($(this).attr('data-index') == that.attr('data-selectedindex')){
                            $(this).css({'background': '#6ea3ff','color': '#fff'});
                            $(this).siblings('li').css({'background': '#fff','color': '#999'});
                        }
                    });

                }).mouseleave(function (event) {
                    $(this).children('img').attr('src', '../img/prl-select.jpg');
                    $(this).children('ul').hide();
                });
                $('.zizhi_type'+(p)).find('ul li').click(function(){
                    console.log($(this).attr('data-ids'));
                    event.stopPropagation();
                    $(this).parent().parent().attr('data-selectedindex', $(this).attr('data-index'));
                    $(this).parent().parent().find('span').text($(this).text());
                    $(this).parent().parent().find('span').attr('data-spanvalue', $(this).attr('data-ids'));
                    $(this).parent().parent().children('img').attr('src', '../img/prl-select.jpg')
                    $(this).parent().css('display','none');
                });

                console.log($('.zizhi_type'+(p)));
                p++;
            },
            error: function (err) {
                console.log(err);
            }
        });



    });


    $(document).on('click', '.btn1', function() {
        $(this).next().find('.sousuo_ul').empty();
        $(this).next().css('display', 'block');
    });

    $(document).on('click', '.sousuo', function () {

        var cont = $(this).prev().prev().val();
        var _this = $(this);

        
        // if ( _this.parent().next('.cousuo_cont').css('display') == 'block') {
        //     _this.parent().next('.cousuo_cont').css('display', 'none');
        // } else if($('.cousuo_cont').css('display') == 'none') {
        //     _this.parent().next('.cousuo_cont').css('display', 'block');
        // }

        $.ajax({
            url: pubIP + 'productApi/listChemicalLikeByName',
            type: 'get',
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            data: {
                chemicalStr: cont
            },
            cache: false,
            dataType: 'json',
            success: function (data) {
                console.log(data);
                if (data.data.length == 0 ) {
                    var str1 = '';
                    str1 += '<li style="color: #999;">暂无数据</li>';
                    _this.parent().next('.cousuo_cont').css('display','block');
                    _this.parent().next('.cousuo_cont').find('.sousuo_ul').empty().html(str1);
                    // $('.sousuo_ul').html(str1);
                } else {
                    var str2 = ''
                    for (var i = 0; i < data.data.length; i++) {
                        str2 += '<li data-index= "'+data.data[i].chemicalId+'" >'+data.data[i].chemicalName+'</li>';
                    }
                    // $('.sousuo_ul').html(str2);
                    _this.parent().next('.cousuo_cont').css('display','block');
                    _this.parent().next('.cousuo_cont').find('.sousuo_ul').empty().html(str2);
                }
            },
            error: function (err) {
                console.log();
            }
        })

    });

    $(document).on('blur', '.input_width', function () {
        if ($(this).val() == '') {
            $(this).parent().next().css('display', 'none');
        }
    })    

    $(document).on('click',function(){
        $('.cousuo_cont').hide();
    })

    $(document).on('click', '.sousuo_ul li', function () {
        if ($(this).text() != '暂无数据') {
            console.log($(this).text());
            $(this).parent().parent().parent().prev().prev().prev().find('.textarea').append('<div data-ind="'+$(this).attr('data-index')+'">'+$(this).text()+'</div>');
        }
    });


    $(document).on('click', '.quxiao_div', function() {
        
        var qiyeid = $(this).parent().attr('data-qiyeid');
       
        if (qiyeid) {
            $.ajax({
                url: pubIP + 'companyCertification/removeQualificationsInfoByQualificationsId',
                type: 'post',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                data: {
                    qualificationsId: qiyeid
                },
                cache: false,
                dataType: 'json',
                success: function (data) {
                    console.log(data);

                    if (data.code == 1) {
                        window.parent.del();
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
        } else {

            $(this).parent().remove();

        }

        

    });

    $(window.parent.document).on('click', '.ok_ok1', function() {
        if ($(this).text() == '确    定') {
            window.location.reload();
        }
    });



   
    $(document).on('click', '.sub', function () {
        if($(".zizhi_num").val()==''){
            alert('资质编号不能为空!');
            return;
        }
        if($("#textarea0").html()==''){
            alert('许可经营范围不能为空!');
            return;
        }
        if($("#test1").val()=='' || $("#test2").val()==''){
            alert('有效期不能为空!');
            return;
        }




        var json = {
            type: 0,
            companyId:companyId,
            
        };

        var zizhi_type = $('.zizhi_type');
        for (var i = 0; i < zizhi_type.length; i++) {
            json['qualificationType'+(i+1)] = $('#zizhi_type'+i).find('span').attr('data-spanvalue');
        }


        $('.zizhi_num').each(function(index, elem) {
            var zizhi_num1 = $(this).val().trim();
            var zizhi_num1_reg = /^\d+$/;

            // if (zizhi_num1_reg.test(zizhi_num1) != true) {
            //     $(this).parent().next().css('display', 'inline-block');
            //     return false;
            // } else {
                json['qualificationNum'+(index+1)] = $(this).val();
            //}
        });

       

        var center1 = $('.center1');

        for (var y = 0; y < center1.length; y++) {

            if ($(center1[y]).attr('data-qiyeid')) {
                json['qualificationId'+(y+1)] = $(center1[y]).attr('data-qiyeid');
            }

            var img = '';
            for (var i = 0; i < $('.c'+y+' .preview').length; i++) {
                
                if ($('.c'+y+' .preview.pic'+(i+1)+'').attr('data-picids')) {
                    img += $('.c'+y+' .preview.pic'+(i+1)+'').attr('data-picids')+',';
                }

                if ($('.c'+y+' .preview').attr('data-flag')) {
                    img += $('.c'+y+' .preview.pic'+(i+1)+'').attr('src')+';';
                } 

            }

            
            json['imgs'+(y+1)] = img;
        
        }

        $('.textarea').each(function (i, ele) {
            var run_fanwei = ';';
            if ($(this).text() == '') {
                $(this).parent().next().css('display', 'inline-block');
                return;
            } else {
                var div = $(this).find('div');
                $(div).each(function (index, element) {
                    run_fanwei += $(this).attr('data-ind')+ ';';
                });
                json['operationLimit'+(i+1)] = run_fanwei;
            }

            
        });

        $('.start').each(function (i, ele) {
            if ($(this).val() == '') {
                $(this).parent().next().css('display', 'block');
            } else {
                json['qualificationDataBegin' + (i+1)] = $(this).val();
            }
            
        });


        $('.end').each(function (i, ele) {

            if ($(this).val() == '') {
                $(this).parent().next().css('display', 'block');
            } else {
                json['qualificationDataExpire' + (i+1)] = $(this).val();
            }
        });

            /* console.log(json);*/

           

        // if (!($(this).attr('disabled')) && $('.zizhi_num').attr('data-f') == 'true' && $('.textarea').attr('data-f') == 'true' && $('.kuang').attr('data-f') == 'true') {
            
            $.ajax({
                url: pubIP + 'companyCertification/addQualificationsBaseInfo',
                type: 'post',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                data: json,
                cache: false,
                dataType: 'json',
                success: function (data) {
                    console.log(data);
                    if (data.code == 1) {
                        window.parent.tan();
                        window.localStorage.setItem('data-subFlag', '0');
                        $('.bottom1 >div').hide();
                    }
                    
                },
                error: function (err) {
                    console.log(err);
                }
            });
        // }
        

    });


    $(document).on('blur', '.zizhi_num', function () {

        var zizhi_num1 = $(this).val().trim();
        var zizhi_num1_reg = /^\d+$/;

        if (zizhi_num1_reg.test(zizhi_num1) != true) {
            $(this).parent().next().css('display', 'inline-block');
            $(this).attr('data-f','false');
            return;
        } else {
            $(this).parent().next().css('display', 'none');
            $(this).attr('data-f','true');
        }

    });



    /*$(document).on('blur', '.input_blur', function() {

        var center1 = $('.center1');

        for (var y = 0; y < center1.length; y++) {

            for (var i = 0; i < $('.c'+y+' .preview').length; i++) {
                console.log(i);
                if ($('.c'+y+' .preview.pic1').prev().attr('src') == '../img/list_logo.png') {
                    $('.c'+y+' .preview.pic1').parent().next().css('display', 'none');
                } else {
                    $('.c'+y+' .preview.pic1').parent().next().css('display', 'inline-block');
                }

            }

        }

    });*/

    $(document).on('blur', '.textarea', function() {

        if ($(this).text() == '') {
            $(this).parent().next().css('display', 'inline-block');
            $(this).attr('data-f','false');
        } else {
            $(this).parent().next().css('display', 'none');
            $(this).attr('data-f','true');
        }

    });

    $(document).on('blur', '.start', function () {
        if ($(this).val() == '') {
            $(this).parent().next().css('display', 'inline-block');
            $(this).attr('data-f','false');
        } else {
            $(this).parent().next().css('display', 'none');
            $(this).attr('data-f','true');
        }
    });

    $(document).on('blur', '.end', function () {
        if ($(this).val() == '') {
            $(this).parent().next().css('display', 'inline-block');
            $(this).attr('data-f','false');
        } else {
            $(this).parent().next().css('display', 'none');
            $(this).attr('data-f','true');
        }
    });
 
 });

</script>
</body>
</html>
