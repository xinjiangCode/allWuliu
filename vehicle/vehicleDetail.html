<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" CONTENT="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="format-detection" content="telephone=no" />
    <title>新疆物流服务平台</title>
    <link rel="stylesheet" type="text/css" href="../css/commin.css"/>
    <link rel="stylesheet" href="../css/vehicleDetail.css">
    <style>
        .requireInfoImg{
            width: 150px;height: 150px;border: 1px solid #f6f6f6;background-color: #f6f6f6;
        }
        .requireInfoTitle{margin: 16px 0;text-align: center;}
        .cf_btn{width: 71px;height: 25px;line-height: 25px;text-align: center;color: white;background-color: #6EA3FF;border-radius: 3px;font-size: 14px;}
        .del{margin-left: 8px;}
    </style>
</head>
<body>
<div class="contbox-prld">
    <div class="toptitle title">
        <span>车辆信息</span>
        <div class="fr closeBtn" style="margin-right: 7px;"><img src="../img/prl-close.png" alt="" width="11" height="11">关&nbsp;&nbsp;闭</div>
        <div class="fr freshBtn cfRefresh"><img src="../img/prl-refresh.png" alt="" width="27" height="34">刷&nbsp;&nbsp;新</div>
    </div>

    <div class="operator infoBox" id="carInfor">
        <div class="title"><img src="../img/prl-titlelogo.png" width="29" height="28" alt="">车辆信息</div>
        <div class="contBox">
            <div class="left ll">
                <div>车&nbsp;&nbsp;牌&nbsp;&nbsp;号：<span id="carNo">新BERER123</span></div>
                <div>增加时间：<span id="createTime">2015-09-08 12：20</span></div>
                <div>车辆品牌：<span id="carBrand">XXXX牌</span></div>
                <div>初次上牌日期：<span id="firstDate">2015-09-08 23:00</span></div>
            </div>
            <div class="left mm">
                <div>车辆档案号：<span id="archivesNo">15544646</span></div>
                <div>车&nbsp;&nbsp;架&nbsp;&nbsp;号：<span id="frameNo">15546266</span></div>
                <div>年审日期：<span id="annualVerificationDate">2015-09-08 12：20</span></div>
                <div>保险日期：<span id="insuranceDate">2015-09-08 12：20</span></div>
            </div>
            <div class="left rr">
                <div>车辆类型：<span id="carType">危化-罐装车</span></div>
                <div>发动机号：<span id="engineNo">126112</span></div>
                <div>车辆载重：<span id="vehicleLoad">150吨</span></div>
            </div>
        </div>
    </div>
    <div class="requireInfo infoBox clearFloat">
        <div class="title"><img src="../img/prl-titlelogo.png" width="29" height="28" alt="">资质信息</div>
        <div class="Lf clearFloat" style="padding: 20px 0 20px 40px;margin-right: 170px;">
            <div class="requireInfoImg">
                <img src="" alt="">
            </div>
            <div class="requireInfoTitle">保险资质上传</div>
            <div class="clearFloat">
                <div class="updata cf_btn Lf">上传</div>
                <div class="del cf_btn Lf">删除</div>
            </div>
        </div>
        <div class="Lf clearFloat" style="padding: 20px 0 20px 40px;margin-right: 170px;">
            <div class="requireInfoImg">
                <img src="" alt="">
            </div>
            <div class="requireInfoTitle">保险资质上传</div>
            <div class="clearFloat">
                <div class="updata cf_btn Lf">上传</div>
                <div class="del cf_btn Lf">删除</div>
            </div>
        </div>
    </div>


    <div class="operator infoBox">
        <div class="title"><img src="../img/prl-titlelogo.png" width="29" height="28" alt="">订单流水</div>
        <div class="listBox" style="overflow-x: auto;">
            <table style="width: 1728px;">
                <thead>
                <tr>
                    <th>司机</th>
                    <th>金额</th>
                    <th>油卡</th>
                    <th>订单号</th>
                    <th>矿发日期 </th>
                    <th>到期日期</th>
                    <th>磅单号</th>
                    <th>矿发磅单号</th>
                    <th>车号</th>
                    <th>过路费</th>
                    <th>到货单位</th>
                    <th>矿发吨位</th>
                    <th>矿发单价</th>
                    <th>接收数</th>
                    <th>实际结算</th>
                    <th>运费单价</th>
                    <th>运费金额</th>
                    <th>磅差</th>
                    <th>合理损耗2‰</th>
                    <th>司机承担数量</th>
                    <th>司机承担金额</th>
                    <th>实际应付金额</th>
                    <th>自由车辆扣款</th>
                    <th>多打款项</th>
                    <th>少打款项</th>
                    <th>油卡</th>
                    <th>疆外油卡</th>
                    <th>轮胎券</th>
                    <th>气卡</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>王小二</td>
                    <td>¥1200.00</td>
                    <td>¥1200.00</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>王小二</td>
                    <td>¥1200.00</td>
                    <td>¥1200.00</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                </tbody>
            </table>
        </div>

    </div>


</div>
<script src="../js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>
<script>
    //Iframe 的高度
    $(function () {
        window.parent.$("#Iframe").css("height","1326");
    })

    //进入页面加载数据
    getData1();
//    getData(1);
    //获取数据
    function getData1() {
        $.ajax({
            url: pubIP + 'tLogisticsVehicle/selectByCarIdDo', /*v1.0*/
            type: 'post',
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            cache: false,
            ansyc: true,
            dataType: 'json',
            data:{
                companyId:companyId,
                carId:sessionStorage.getItem("detailId")
            },
            success: function (res) {
                if(res.code===1){
                    cf_dataRender1(res)
                }else{
                    alert(res.msg);
                }
            },
            error: function(err){
                console.log(err);
            }
        });
    }
    //渲染数据
    function cf_dataRender1(dataAll) {
        var data=dataAll.data;
        var data1=dataAll.data1;
        $("#carBrand").text(data.carBrand);
        $("#carType").text(data.carType);
        $("#annualVerificationDate").text(timestampToTime(data.annualVerificationDate));
        $("#archivesNo").text(data.archivesNo);
        $("#firstDate").text(timestampToTime(data.firstDate));
        $("#insuranceDate").text(timestampToTime(data.insuranceDate));
        $("#createTime").text(timestampToTime(data.createTime));
        $("#carNo").text(data.carNo);
        $("#engineNo").text(data.engineNo);
        $("#frameNo").text(data.frameNo);
        $("#vehicleLoad").text(data.vehicleLoad);

        var str="";
        $.each(data1,function (idx,item) {
            str='<div>'+item.name+'：<span>'+item.value+'</span></div>';
            if(idx%3===0){
                $("#carInfor .contBox .rr").append(str);
            }else if(idx%3===1){
                $("#carInfor .contBox .ll").append(str);
            }else if(idx%3===2){
                $("#carInfor .contBox .mm").append(str);
            }

        })
    }





    //获取数据
    function getData(currentPage) {
        $.ajax({
            url: pubIP + 'tLogisticsVehicleRoute/selectByCarList', /*v1.0*/
            type: 'post',
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            cache: false,
            ansyc: true,
            dataType: 'json',
            data:{
                companyId:companyId,
//                sort:$(".sort").attr("data-selectedindex"),
                routeId:sessionStorage.getItem("detailId"),
                size:pageSize,
                page:currentPage
            },
            success: function (res) {
                if(res.code===1){
                    //首次请求时 改变分页数据
                    if(res.data.length==0){
                        $(".listBox tbody").html("");$(".pagination").parent().css("display","none");
                        window.parent.$("#Iframe").css("height",979);
                        return;
                    }
                    if(currentPage===1 ){
                        //修改底部分页
                        debugger
                        var pageNum=Math.ceil(res.count/pageSize);
                        $(".allPageN").attr("pageTotal",pageNum);
                        $(".pageJump i").text("共"+pageNum+"页");
                        $('.objListBox>div:nth-child(5n)').css('margin-right','0');
                        Page({
                            num: pageNum,
                            elem: $('#page1'),
                            callback: function(n) {
                                // console.log(n);
                                getData(n);//加载n页数据
                            }
                        });
                    }
                    //修改底部页数
                    $(".allPageN").text((currentPage)+"/"+ $(".allPageN").attr("pageTotal"));
                    cf_dataRender(res.data)
                }else{
                    alert(res.msg);
                }
            },
            error: function(err){
                console.log(err);
            }
        });
    }
    //渲染数据
    function cf_dataRender(data) {
        var str='';
        $.each(data,function (idx,item) {
            str+='<tr>';
            str+='<td>'+item.carNo+'</td>';
            if(item.type==0){
                str+='<td>内部车辆</td>';
            }else {
                str+='<td>外部车辆</td>';
            }
            str+='<td>'+item.carBrand+'</td>';
            str+='<td>'+item.carType+'</td>';
            str+='<td>'+item.archivesNo+'</td>';
            str+='<td>'+timestampToTime(item.annualVerificationDate)+'</td>';
            str+='</tr>';
        })
        $(".listBox tbody").html(str);
    }
    // 点击go刷新数据
    $('.pageCont').on('click', '.button',function(){
        var currentPage = $('.pageCont li.active>a').text();
        getData(currentPage);
    })
</script>
</body>
</html>